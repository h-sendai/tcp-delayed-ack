# TCP Delayed Ack

- サーバーは起動して、read()で待つ。
- クライアントは起動して接続するとwrite()で1バイト書き、
  続けてread()で待つ。
- サーバーは1バイトread()して1バイトwrite()する。
- クライアントはread()で1バイト読む。
- クライアントは1秒sleep()する。
- 以下繰り返し。何回繰り返すかは-nオプションで指定する。

```
クライアント            サーバー

1バイト ----------->
        <----------- 1バイト

(スリープ1秒)

1バイト ----------->
        <----------- 1バイト
```

## FreeBSD client <----> Linux Server

FreeBSD 13.2でクライアントを

```
./client -n 50 -s 500000 linux-server
```

で起動したときのクライアント側(FreeBSD側)で取得した
[キャプチャデータ](client-on-FreeBSD.txt)。
length 0のところがdelayed ackになっていてデータを受信してから
40ミリ秒後にackをだしているのがわかる。

192.168.10.204がFreeBSD、192.168.10.201がAlmaLinux 8。

```
1.050133 0.475808 IP 192.168.10.204.51934 > 192.168.10.201.1234:  Flags [P.], seq 3:4, ack 3, win 1027, length 1
1.050326 0.000193 IP 192.168.10.201.1234  > 192.168.10.204.51934: Flags [P.], seq 3:4, ack 4, win 229, length 1
1.092328 0.042002 IP 192.168.10.204.51934 > 192.168.10.201.1234:  Flags [.], ack 4, win 1027, length 0
```

